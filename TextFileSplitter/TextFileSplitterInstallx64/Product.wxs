<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="F5EAB312-C807-40A7-BA81-5EDFD3D4F8F6" Name="Text File Splitter x64" Language="1033" Version="1.0.0.0" Manufacturer="Keith Martin" UpgradeCode="A9EE6818-88C5-4E7F-A2E4-C7BC52E7FF8D">
    <Package InstallerVersion="300" Compressed="yes" InstallScope="perMachine" />

    <UIRef Id="WixUI_FeatureTree"/>
    <WixVariable Id="WixUILicenseRtf" Value="$(var.TextFileSplitter2012.ProjectDir)\License.rtf" />


    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <Media Id="1" Cabinet="TextFileSplitter.cab" EmbedCab="yes" />

    <Property Id="SSIS64_2012">
      <RegistrySearch Type="directory" Id="SSIS64_2012" Root="HKLM" Key="SOFTWARE\Microsoft\Microsoft SQL Server\110\SSIS\Setup\DTSPath" Win64="yes"/>
    </Property>
    <Property Id="SSIS32_2012">
      <RegistrySearch Type="directory" Id="SSIS32_2012" Root="HKLM" Key="SOFTWARE\Microsoft\Microsoft SQL Server\110\SSIS\Setup\DTSPath" Win64="no"/>
    </Property>
    <Property Id="SSIS64_2008">
      <RegistrySearch Type="directory" Id="SSIS64_2008" Root="HKLM" Key="SOFTWARE\Microsoft\Microsoft SQL Server\100\SSIS\Setup\DTSPath" Win64="yes"/>
    </Property>
    <Property Id="SSIS32_2008">
      <RegistrySearch Type="directory" Id="SSIS32_2008" Root="HKLM" Key="SOFTWARE\Microsoft\Microsoft SQL Server\100\SSIS\Setup\DTSPath" Win64="no"/>
    </Property>

    <!-- We need to find either or both a 32 or 64 bit install of SSIS 2008 or 2012. -->
    <Condition Message="SQL Server Integration Services is not installed on this computer.  Please install SQL Server Integration Services before running this installer.">
      Installed OR SSIS64_2012 OR SSIS32_2012 OR SSIS64_2008 OR SSIS32_2008
    </Condition>

    <Condition Message="You need to be an administrator to install this product.">
      Privileged
    </Condition>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Component Id="FileHelperLibrary" Guid="25D5591A-397A-47F9-9473-5D6A1248D138">
        <File Id="FileHelperDLLGac" Name="$(var.FileHelpers.TargetFileName)" Source="$(var.FileHelpers.TargetPath)" Assembly=".net" KeyPath="yes"/>
      </Component>

      <Directory Id="SSIS64_2012" Name="SSIS64_2012">
        <Directory Id="SQL2012x64Pipeline" Name="PipelineComponents">
          <Component Id="SQL2012x64DLL" Guid="9F413B6A-6B5B-4384-8155-D9BE2AFADD66" Win64="yes">
            <File Id="SQL2012x64DLLFile" Name="$(var.TextFileSplitter2012.TargetFileName)" Source="$(var.TextFileSplitter2012.TargetPath)" />
          </Component>
        </Directory>
      </Directory>

      <Directory Id="SSIS32_2012" Name="SSIS32_2012">
        <Directory Id="SQL2012x32Pipeline" Name="PipelineComponents">
          <Component Id="SQL2012x32DLL" Guid="11CAEB1C-E1A7-4D7C-BC33-C3E003D1D6F6" Win64="no">
            <File Id="SQL2012x32DLLFile" Name="$(var.TextFileSplitter2012.TargetFileName)" Source="$(var.TextFileSplitter2012.TargetPath)" />
          </Component>
        </Directory>
      </Directory>

      <Directory Id="SSIS64_2008" Name="SSIS64_2008">
        <Directory Id="SQL2008x64Pipeline" Name="PipelineComponents">
          <Component Id="SQL2008x64DLL" Guid="A95E0ADB-3A10-48E5-98B5-4DCEF04C7E69" Win64="yes">
            <File Id="SQL2008x64DLLFile" Name="$(var.TextFileSplitter2008.TargetFileName)" Source="$(var.TextFileSplitter2008.TargetPath)" />
          </Component>
        </Directory>
      </Directory>

      <Directory Id="SSIS32_2008" Name="SSIS32_2008">
        <Directory Id="SQL2008x32Pipeline" Name="PipelineComponents">
          <Component Id="SQL2008x32DLL" Guid="2F66CDAC-39E1-49AD-B7DB-E6EDCD4E32CC" Win64="no">
            <File Id="SQL2008x32DLLFile" Name="$(var.TextFileSplitter2008.TargetFileName)" Source="$(var.TextFileSplitter2008.TargetPath)" />
          </Component>
        </Directory>
      </Directory>
    </Directory>

    <Feature Id="Complete" Level="1" Title="Text File Splitter Installer 1.0" Description="An SSIS Component to split Delimted Text files" Display="expand">
      <Feature Id="SQL2012" Level="1" Title="SQL 2012">
        <Feature Id="SQL2012x64" Level="1" Title="x64">
          <ComponentRef Id="SQL2012x64DLL"/>
          <Condition Level="1">SSIS64_2012</Condition>
        </Feature>
        <Feature Id="SQL2012x32" Level="1" Title="x86">
          <ComponentRef Id="SQL2012x32DLL"/>
          <Condition Level="1">SSIS32_2012</Condition>
        </Feature>
      </Feature>
      <Feature Id="SQL2008" Level="10" Title="SQL 2008">
        <Feature Id="SQL2008x64" Level="1" Title="x64">
          <ComponentRef Id="SQL2008x64DLL"/>
          <Condition Level="1">SSIS64_2008</Condition>
        </Feature>
        <Feature Id="SQL2008x32" Level="1" Title="x86">
          <ComponentRef Id="SQL2008x32DLL"/>
          <Condition Level="1">SSIS32_2008</Condition>
        </Feature>
      </Feature>
      <Feature Id="FileHelper" Level="1" Title="FileHelper DLL (required)">
        <ComponentRef Id="FileHelperLibrary"/>
      </Feature>
    </Feature>
  </Product>
</Wix>